# 巨蜂科技客户管理信息系统 - 需求规格说明书

## 1. 修订历史

| 版本 | 日期 | 作者 | 修订说明 |
| :--- | :--- | :--- | :--- |
| v1.0 | 2025-07-14 | Roo | 初稿创建 |

## 2. 引言

### 2.1. 项目背景
为满足巨蜂科技有限公司内部销售团队的管理需求，特开发此客户管理信息系统。系统旨在规范销售流程、提升客户管理效率、沉淀业务数据，为公司业务发展提供数据支持。

### 2.2. 项目目标
-   **核心目标**: 实现客户信息、销售过程、订单与合同、售后服务的全生命周期线上管理。
-   **客户端**: 提供一个在 Windows 操作系统上运行的桌面客户端。
-   **服务端**: 部署在公司自有的阿里云服务器 (Ubuntu) 上。

### 2.3. 项目范围
本项目范围涵盖从需求分析、系统设计、开发、测试到最终交付的完整软件开发周期。功能范围严格遵循本文档定义的功能模块。

## 3. 系统架构

### 3.1. 技术选型
-   **客户端**: PySide6 (Python)
-   **服务端**: FastAPI (Python)
-   **数据库**: SQLite
-   **部署环境**: 阿里云 Ubuntu 服务器

### 3.2. 架构图
```mermaid
graph TD
    subgraph "Windows 客户端"
        A[PySide6 应用]
    end

    subgraph "阿里云 Ubuntu 服务器"
        B[FastAPI 后端服务]
        C[SQLite 数据库 (project.db)]
        D[文件存储 (uploads)]
        E[自动备份脚本 (Cron Job)]
    end

    A -- RESTful API --> B;
    B -- CRUD操作 --> C;
    B -- 文件读写 --> D;
    E -- 定时执行 --> C;
```

## 4. 数据模型与实体定义

### 4.1. 数据关系ER图
*(此处引用用户提供的ER图)*

### 4.2. 实体详细定义
以下是系统中核心数据实体的详细定义，作为数据库表结构和后端模型的直接依据。

#### 4.2.1. 部门 (department)
-   **核心属性**: `id` (主键), `name` (名称), `created_at` (创建时间)
-   **功能描述**: 组织架构的顶层单位。

#### 4.2.2. 部门分组 (department_group)
-   **核心属性**: `id` (主键), `department_id` (外键), `name` (分组名称)
-   **功能描述**: 部门内部的细分单元，与部门为一对多关系。

#### 4.2.3. 员工 (employee)
-   **核心属性**: `id` (主键), `department_id` (外键), `group_id` (外键), `name`, `position`, `phone`, `username`, `password_hash`, `created_at`
-   **特殊字段**: `password_hash` 用于存储加盐哈希后的密码，确保安全。
-   **功能描述**: 系统的使用者主体，关联其所属部门和分组。

#### 4.2.4. 客户 (customer)
-   **核心属性**: `id` (主键), `industry`, `province`, `city`, `company`, `address`, `status`, `sales_id` (外键), `service_id` (外键), `created_at`
-   **功能描述**: 业务流程的核心对象，记录了客户的基本信息和归属。

#### 4.2.5. 联系人 (contact)
-   **核心属性**: `id` (主键), `customer_id` (外键), `name`, `phone`, `position`, `email`
-   **功能描述**: 客户方的具体对接人员，一个客户可有多个联系人。

#### 4.2.6. 产品 (product)
-   **核心属性**: `id` (主键), `name`, `unit`, `service_period`, `base_price`, `real_price`, `sales_commission`, `manager_commission`, `director_commission`
-   **特殊字段**: 包含针对销售、经理、总监的三级佣金提成规则。
-   **功能描述**: 公司提供的可销售商品或服务。

#### 4.2.7. 销售跟进 (sales_follow)
-   **核心属性**: `id` (主键), `customer_id` (外键), `contact_id` (外键), `sales_id` (外键), `content`, `intention`, `next_follow_date`
-   **功能描述**: 记录销售人员与客户的日常交互过程。

#### 4.2.8. 订单 (orders)
-   **核心属性**: `id` (主键), `order_no`, `customer_id` (外键), `product_id` (外键), `sales_id` (外键), `actual_price`, `quantity`, `amount` (虚拟), `start_date`, `end_date`, `status`
-   **特殊字段**: `amount` 是一个计算字段 (`actual_price` * `quantity`)，不在数据库中直接存储，由业务逻辑计算。
-   **功能描述**: 客户交易的核心凭证。

#### 4.2.9. 服务记录 (service_record)
-   **核心属性**: `id` (主键), `order_id` (外键), `customer_id` (外键), `contact_id` (外键), `service_id` (外键), `feedback`, `response`, `status`
-   **功能描述**: 跟踪和记录售后服务的全过程。

#### 4.2.10. 审计日志 (audit_log)
-   **核心属性**: `id` (主键), `user_id` (操作用户外键), `action` (操作类型), `target_table`, `target_id`, `details`, `created_at`
-   **功能描述**: 记录系统中关键操作的日志，用于审计和问题追溯。

## 5. 用户角色与权限

| 角色 | 核心职责描述 |
| :--- | :--- |
| **系统管理员** | 拥有所有权限，负责系统设置、部门/员工管理、用户权限分配、密码重置。 |
| **销售主管** | 负责分配名下部门的销售人员给客户，查看部门内所有数据。 |
| **销售人员** | 查看和跟进分配给自己的客户，创建订单。 |
| **客服主管** | 负责分配名下部门的客服人员进行售后服务。 |
| **客服人员** | 处理分配给自己的售后服务工单。 |
| **财务人员** | 查看订单信息，拥有“确认收款”权限，将订单状态变更为“已收款”。|

## 6. 功能性需求

### 6.1. 登录模块
-   **FR-LOGIN-01**: 用户使用“登录账号”和“密码”进行登录。
-   **FR-LOGIN-02**: 提供“记住密码”和“自动登录”选项。
-   **FR-LOGIN-03**: 系统管理员有权在后台重置任何员工的密码。

### 6.2. 组织架构模块
-   **FR-ORG-01**: 系统管理员可以增、删、改部门。
-   **FR-ORG-02**: 系统管理员可以增、删、改部门下的分组。
-   **FR-ORG-03**: 系统管理员可以增、删、改员工信息，并为员工指定部门、分组和角色。

### 6.3. 客户管理模块
-   **FR-CUST-01**: 支持客户信息的增、删、改、查。
-   **FR-CUST-02**: 创建客户时，客户状态默认为“未分配”。
-   **FR-CUST-03**: 销售主管可以将“未分配”的客户或自己部门下的客户，分配给对应的销售人员。
-   **FR-CUST-04**: 支持多条件筛选客户（如行业、省份、城市、客户状态）。
-   **FR-CUST-05**: 支持添加和管理客户的多个联系人。

### 6.4. 销售与跟进模块
-   **FR-SALE-01**: 销售可以为自己名下的客户添加跟进记录。
-   **FR-SALE-02**: 销售可以为客户创建订单。

### 6.5. 订单与财务模块
-   **FR-ORDER-01**: 创建订单时需要关联客户和选择产品。
-   **FR-ORDER-02**: 财务人员可以查看所有订单，并执行“确认收款”操作。
-   **FR-ORDER-03**: 订单被“确认收款”后，其状态变为“已收款”，此操作不可逆。

### 6.6. 其他模块
-   **FR-PROD-01**: 系统管理员负责产品信息的增、删、改、查。
-   **FR-SERVICE-01**: 客服人员可以处理和记录售后服务工单。
-   **FR-DASH-01**: 提供数据视窗，用于展示关键业务指标（具体指标待定）。
-   **FR-DEV-01**: 对于原型图中缺失的界面，开发时需参考现有界面的UI/UX风格进行补充设计。

## 7. 非功能性需求
根据项目初期规划，非功能性需求将进行简化设计，待核心功能稳定后再进行迭代。
-   **性能**: 系统应保证在 50 人以内同时在线的流畅使用。常规列表查询响应时间应在 3 秒以内。
-   **安全**: 实现基于角色的访问控制。数据库应进行每日自动备份。
-   **数据迁移**: v1.0版本不考虑历史数据迁移功能。
-   **第三方集成**: v1.0版本不考虑与外部系统的集成。